<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shopping List App</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .checked {
        text-decoration: line-through;
        color: #9ca3af;
      }
      .profile-btn.active {
        background-color: #6366f1;
        color: #fff;
        border-color: #6366f1;
        box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.3),
          0 2px 4px -1px rgba(99, 102, 241, 0.2);
      }
    </style>
  </head>
  <body
    class="bg-slate-900 flex items-center justify-center min-h-screen p-4 font-[Inter] bg-[radial-gradient(ellipse_at_bottom,_var(--tw-gradient-stops))] from-gray-700 via-gray-900 to-black"
  >
    <div
      class="bg-gray-800 text-white rounded-3xl shadow-2xl p-8 max-w-lg w-full transform transition-all hover:scale-105 duration-300"
    >
      <h1
        class="text-4xl font-extrabold text-center text-white mb-6 tracking-wide"
      >
        My Shopping List
      </h1>

      <!-- Profile Management Section -->
      <div
        class="flex flex-col items-stretch space-y-2 mb-6 p-4 rounded-xl bg-gray-900 border-2 border-gray-700"
      >
        <h2 class="text-xl font-bold text-center text-gray-400">
          Select Profile
        </h2>
        <div
          id="profileButtons"
          class="flex flex-wrap justify-center gap-2 mb-4"
        ></div>
        <div class="flex items-center space-x-2">
          <input
            type="text"
            id="profileInput"
            placeholder="New profile name..."
            maxlength="10"
            class="flex-grow p-2 rounded-xl border-2 border-gray-700 bg-gray-900 text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500 transition-colors shadow-inner"
          />
          <button
            id="addProfileBtn"
            class="bg-indigo-600 text-white p-2 rounded-xl hover:bg-indigo-700 transition-colors font-semibold shadow-md active:scale-95"
          >
            Add
          </button>
          <button
            id="deleteProfileBtn"
            class="bg-red-600 text-white p-2 rounded-xl hover:bg-red-700 transition-colors font-semibold shadow-md active:scale-95"
          >
            Delete
          </button>
        </div>
        <div
          id="profileMessageBox"
          class="text-sm text-center mt-2 font-medium"
        ></div>
      </div>

      <!-- Manage List Section -->
      <div
        class="flex flex-col items-stretch space-y-2 mb-6 p-4 rounded-xl bg-gray-900 border-2 border-gray-700"
      >
        <h2 class="text-xl font-bold text-center text-gray-400">Manage List</h2>
        <div class="flex items-center space-x-2">
          <input
            type="file"
            id="fileInput"
            accept=".txt"
            class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100"
          />
          <button
            id="importButton"
            class="bg-emerald-600 text-white p-2 rounded-xl hover:bg-emerald-700 transition-colors font-semibold shadow-md active:scale-95 w-32"
          >
            Import
          </button>
        </div>
        <button
          id="exportButton"
          class="bg-yellow-500 text-white p-2 rounded-xl hover:bg-yellow-600 transition-colors font-semibold shadow-md active:scale-95"
        >
          Export List
        </button>
        <div id="messageBox" class="text-sm text-center mt-2 font-medium"></div>
      </div>

      <!-- Input and Add Button Section -->
      <div class="flex items-center space-x-2 mb-6">
        <input
          type="text"
          id="itemInput"
          placeholder="What do you need?"
          class="flex-grow p-4 rounded-xl border-2 border-gray-700 bg-gray-900 text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500 transition-colors shadow-inner"
        />
        <button
          id="addButton"
          class="bg-indigo-600 text-white p-4 rounded-xl hover:bg-indigo-700 transition-all font-semibold shadow-md active:scale-95"
        >
          Add
        </button>
      </div>

      <!-- Shopping List Items -->
      <ul id="shoppingList" class="space-y-3"></ul>
    </div>

    <script>
      const itemInput = document.getElementById("itemInput");
      const addButton = document.getElementById("addButton");
      const shoppingList = document.getElementById("shoppingList");
      const fileInput = document.getElementById("fileInput");
      const importButton = document.getElementById("importButton");
      const exportButton = document.getElementById("exportButton");
      const messageBox = document.getElementById("messageBox");
      const profileButtonsContainer = document.getElementById("profileButtons");
      const profileInput = document.getElementById("profileInput");
      const addProfileBtn = document.getElementById("addProfileBtn");
      const deleteProfileBtn = document.getElementById("deleteProfileBtn");
      const profileMessageBox = document.getElementById("profileMessageBox");

      let profiles =
        JSON.parse(localStorage.getItem("shoppingListProfiles")) || {};
      let activeProfile =
        localStorage.getItem("activeShoppingListProfile") || null;

      function saveProfiles() {
        localStorage.setItem("shoppingListProfiles", JSON.stringify(profiles));
        localStorage.setItem("activeShoppingListProfile", activeProfile);
      }

      function createListItem(text) {
        const li = document.createElement("li");
        li.className =
          "flex items-center bg-gray-700 rounded-xl p-4 shadow-md transition-all hover:bg-gray-600 duration-200 ease-in-out";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.className =
          "mr-4 h-6 w-6 text-indigo-500 rounded-md border-gray-500 bg-gray-800 focus:ring-indigo-400 transition-colors cursor-pointer";

        const itemText = document.createElement("span");
        itemText.textContent = text;
        itemText.className = "flex-grow text-gray-200 text-lg font-medium";

        const pushButton = document.createElement("button");
        pushButton.className =
          "ml-2 cursor-pointer text-gray-400 hover:text-indigo-500 transition-colors active:scale-95 push-button";
        pushButton.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 13l-7 7-7-7m14-8l-7 7-7-7" />
          </svg>
        `;

        const deleteButton = document.createElement("button");
        deleteButton.className =
          "ml-4 cursor-pointer text-gray-400 hover:text-red-500 transition-colors active:scale-95";
        deleteButton.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        `;

        li.appendChild(checkbox);
        li.appendChild(itemText);
        li.appendChild(pushButton);
        li.appendChild(deleteButton);

        return li;
      }

      // ✅ Fixed renderShoppingList
      function renderShoppingList() {
        shoppingList.innerHTML = "";

        if (activeProfile && profiles[activeProfile]) {
          const unchecked = [];
          const checked = [];

          profiles[activeProfile].forEach((item) => {
            const li = createListItem(item.name);
            const checkbox = li.querySelector('input[type="checkbox"]');
            const textSpan = li.querySelector("span");

            if (item.checked) {
              checkbox.checked = true;
              textSpan.classList.add("checked");
              checked.push(li);
            } else {
              unchecked.push(li);
            }
          });

          // Append in proper order: unchecked first, then checked
          unchecked.forEach((li) => shoppingList.appendChild(li));
          checked.forEach((li) => shoppingList.appendChild(li));
        }
      }

      function displayMessage(text, color, targetMessageBox) {
        targetMessageBox.textContent = text;
        targetMessageBox.className = `text-sm text-center mt-2 font-medium ${color}`;
        setTimeout(() => {
          targetMessageBox.textContent = "";
          targetMessageBox.className = "text-sm text-center mt-2 font-medium";
        }, 3000);
      }

      // ✅ New items now go on top of unchecked
      function addItem() {
        if (!activeProfile) {
          displayMessage(
            "Please select a profile first.",
            "text-red-400",
            messageBox
          );
          return;
        }
        const itemText = itemInput.value.trim();
        if (itemText !== "") {
          profiles[activeProfile].unshift({ name: itemText, checked: false }); // 👈 use unshift
          saveProfiles();
          renderShoppingList();
          itemInput.value = "";
          itemInput.focus();
        }
      }

      function importItemsFromFile() {
        if (!activeProfile) {
          displayMessage(
            "Please select a profile first.",
            "text-red-400",
            messageBox
          );
          return;
        }
        const file = fileInput.files[0];
        if (!file) {
          displayMessage(
            "Please select a file first.",
            "text-red-400",
            messageBox
          );
          return;
        }

        const reader = new FileReader();
        reader.onload = (e) => {
          const content = e.target.result;
          const items = content
            .split(/\r?\n/)
            .filter((line) => line.trim() !== "");

          if (items.length === 0) {
            displayMessage(
              "File is empty or contains no valid items.",
              "text-red-400",
              messageBox
            );
            return;
          }

          items.forEach((item) => {
            profiles[activeProfile].push({ name: item.trim(), checked: false });
          });
          saveProfiles();
          renderShoppingList();
          displayMessage(
            `Successfully imported ${items.length} items.`,
            "text-green-400",
            messageBox
          );
          fileInput.value = "";
        };

        reader.onerror = () => {
          displayMessage("Error reading file.", "text-red-400", messageBox);
        };

        reader.readAsText(file);
      }

      function exportListToFile() {
        if (!activeProfile) {
          displayMessage(
            "Please select a profile first.",
            "text-red-400",
            messageBox
          );
          return;
        }
        const listItems = profiles[activeProfile];
        if (listItems.length === 0) {
          displayMessage(
            "Your list is empty. Nothing to export.",
            "text-red-400",
            messageBox
          );
          return;
        }

        const listContent = listItems.map((item) => item.name).join("\n");
        const blob = new Blob([listContent], { type: "text/plain" });

        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = `${activeProfile}-shopping-list.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(a.href);

        displayMessage(
          "Your list has been exported!",
          "text-yellow-400",
          messageBox
        );
      }

      function renderProfileButtons() {
        profileButtonsContainer.innerHTML = "";
        const profileNames = Object.keys(profiles);
        profileNames.forEach((name) => {
          const btn = document.createElement("button");
          btn.textContent = name;
          btn.className = `profile-btn p-2 rounded-xl border-2 border-gray-700 bg-gray-900 hover:bg-indigo-600 hover:border-indigo-600 transition-colors active:scale-95 text-sm font-semibold ${
            name === activeProfile ? "active" : ""
          }`;
          btn.onclick = () => {
            activeProfile = name;
            saveProfiles();
            renderProfileButtons();
            renderShoppingList();
          };
          profileButtonsContainer.appendChild(btn);
        });
      }

      function addProfile() {
        const profileName = profileInput.value.trim();
        if (profileName === "") {
          displayMessage(
            "Profile name cannot be empty.",
            "text-red-400",
            profileMessageBox
          );
          return;
        }
        if (Object.keys(profiles).length >= 4) {
          displayMessage(
            "Maximum of 4 profiles allowed.",
            "text-red-400",
            profileMessageBox
          );
          return;
        }
        if (profiles[profileName]) {
          displayMessage(
            "A profile with this name already exists.",
            "text-red-400",
            profileMessageBox
          );
          return;
        }
        profiles[profileName] = [];
        activeProfile = profileName;
        profileInput.value = "";
        saveProfiles();
        renderProfileButtons();
        renderShoppingList();
      }

      function deleteProfile() {
        if (!activeProfile) {
          displayMessage(
            "Please select a profile to delete.",
            "text-red-400",
            profileMessageBox
          );
          return;
        }
        if (
          confirm(
            `Are you sure you want to delete the profile "${activeProfile}" and all its items?`
          )
        ) {
          delete profiles[activeProfile];
          activeProfile = Object.keys(profiles)[0] || null;
          saveProfiles();
          renderProfileButtons();
          renderShoppingList();
          displayMessage(
            `Profile deleted.`,
            "text-green-400",
            profileMessageBox
          );
        }
      }

      addButton.addEventListener("click", addItem);
      itemInput.addEventListener("keypress", (event) => {
        if (event.key === "Enter") addItem();
      });
      importButton.addEventListener("click", importItemsFromFile);
      exportButton.addEventListener("click", exportListToFile);
      addProfileBtn.addEventListener("click", addProfile);
      deleteProfileBtn.addEventListener("click", deleteProfile);
      profileInput.addEventListener("keypress", (event) => {
        if (event.key === "Enter") addProfile();
      });

      shoppingList.addEventListener("click", (event) => {
        if (!activeProfile) return;
        const clickedElement = event.target;
        const listItem = clickedElement.closest("li");
        if (!listItem) return;

        const checkbox = listItem.querySelector('input[type="checkbox"]');
        const deleteButton = listItem.querySelector("button:last-child");
        const pushButton = listItem.querySelector(".push-button");
        const itemText = listItem.querySelector("span").textContent;

        const itemIndex = profiles[activeProfile].findIndex(
          (item) => item.name === itemText
        );

        if (clickedElement === checkbox) {
          profiles[activeProfile][itemIndex].checked = checkbox.checked;
          saveProfiles();
          renderShoppingList();
        }

        if (
          clickedElement === pushButton ||
          pushButton.contains(clickedElement)
        ) {
          const itemToMove = profiles[activeProfile].splice(itemIndex, 1)[0];
          profiles[activeProfile].push(itemToMove);
          saveProfiles();
          renderShoppingList();
        }

        if (
          clickedElement === deleteButton ||
          deleteButton.contains(clickedElement)
        ) {
          profiles[activeProfile].splice(itemIndex, 1);
          saveProfiles();
          renderShoppingList();
        }
      });

      shoppingList.addEventListener("dblclick", (event) => {
        if (!activeProfile) return;
        const clickedElement = event.target;
        if (clickedElement.tagName === "SPAN") {
          const li = clickedElement.closest("li");
          const currentText = clickedElement.textContent;

          const input = document.createElement("input");
          input.type = "text";
          input.value = currentText;
          input.className =
            "flex-grow p-1 rounded-md border-2 border-indigo-500 bg-gray-900 text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500 transition-colors shadow-inner";

          li.replaceChild(input, clickedElement);
          input.focus();

          const saveEdit = () => {
            const newText = input.value.trim();
            const newSpan = document.createElement("span");
            newSpan.textContent = newText !== "" ? newText : currentText;
            newSpan.className = "flex-grow text-gray-200 text-lg font-medium";
            li.replaceChild(newSpan, input);

            const itemIndex = profiles[activeProfile].findIndex(
              (item) => item.name === currentText
            );
            if (itemIndex !== -1) {
              profiles[activeProfile][itemIndex].name = newText;
              saveProfiles();
            }

            const checkbox = li.querySelector('input[type="checkbox"]');
            if (checkbox.checked) {
              newSpan.classList.add("checked");
            }
          };

          input.addEventListener("blur", saveEdit);
          input.addEventListener("keypress", (e) => {
            if (e.key === "Enter") saveEdit();
          });
        }
      });

      renderProfileButtons();
      renderShoppingList();

      // ⬆️ Move item up
      function moveItemUp(profile, index) {
        if (index > 0) {
          const temp = profiles[profile][index];
          profiles[profile][index] = profiles[profile][index - 1];
          profiles[profile][index - 1] = temp;
          saveProfiles();
          renderShoppingList();
        }
      }

      // ⬇️ Move item down
      function moveItemDown(profile, index) {
        if (index < profiles[profile].length - 1) {
          const temp = profiles[profile][index];
          profiles[profile][index] = profiles[profile][index + 1];
          profiles[profile][index + 1] = temp;
          saveProfiles();
          renderShoppingList();
        }
      }

      // ✅ Modify createListItem to add up/down buttons
      function createListItem(text) {
        const li = document.createElement("li");
        li.className =
          "flex items-center bg-gray-700 rounded-xl p-4 shadow-md transition-all hover:bg-gray-600 duration-200 ease-in-out";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.className =
          "mr-4 h-6 w-6 text-indigo-500 rounded-md border-gray-500 bg-gray-800 focus:ring-indigo-400 transition-colors cursor-pointer";

        const itemText = document.createElement("span");
        itemText.textContent = text;
        itemText.className = "flex-grow text-gray-200 text-lg font-medium";

        // ⬆️ Up Button
        const upButton = document.createElement("button");
        upButton.className =
          "ml-2 cursor-pointer text-gray-400 hover:text-green-500 transition-colors active:scale-95 move-up";
        upButton.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
      </svg>
    `;

        // ⬇️ Down Button
        const downButton = document.createElement("button");
        downButton.className =
          "ml-2 cursor-pointer text-gray-400 hover:text-blue-500 transition-colors active:scale-95 move-down";
        downButton.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
      </svg>
    `;

        const pushButton = document.createElement("button");
        pushButton.className =
          "ml-2 cursor-pointer text-gray-400 hover:text-indigo-500 transition-colors active:scale-95 push-button";
        pushButton.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 13l-7 7-7-7m14-8l-7 7-7-7" />
      </svg>
    `;

        const deleteButton = document.createElement("button");
        deleteButton.className =
          "ml-4 cursor-pointer text-gray-400 hover:text-red-500 transition-colors active:scale-95";
        deleteButton.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    `;

        li.appendChild(checkbox);
        li.appendChild(itemText);
        li.appendChild(upButton);
        li.appendChild(downButton);
        li.appendChild(pushButton);
        li.appendChild(deleteButton);

        return li;
      }

      // ✅ Extend event delegation for up/down buttons
      shoppingList.addEventListener("click", (event) => {
        if (!activeProfile) return;
        const clickedElement = event.target;
        const listItem = clickedElement.closest("li");
        if (!listItem) return;

        const checkbox = listItem.querySelector('input[type="checkbox"]');
        const deleteButton = listItem.querySelector("button:last-child");
        const pushButton = listItem.querySelector(".push-button");
        const upButton = listItem.querySelector(".move-up");
        const downButton = listItem.querySelector(".move-down");
        const itemText = listItem.querySelector("span").textContent;

        const itemIndex = profiles[activeProfile].findIndex(
          (item) => item.name === itemText
        );

        if (clickedElement === checkbox) {
          profiles[activeProfile][itemIndex].checked = checkbox.checked;
          saveProfiles();
          renderShoppingList();
        }

        if (clickedElement === upButton || upButton.contains(clickedElement)) {
          moveItemUp(activeProfile, itemIndex);
        }

        if (
          clickedElement === downButton ||
          downButton.contains(clickedElement)
        ) {
          moveItemDown(activeProfile, itemIndex);
        }

        if (
          clickedElement === pushButton ||
          pushButton.contains(clickedElement)
        ) {
          const itemToMove = profiles[activeProfile].splice(itemIndex, 1)[0];
          profiles[activeProfile].push(itemToMove);
          saveProfiles();
          renderShoppingList();
        }

        if (
          clickedElement === deleteButton ||
          deleteButton.contains(clickedElement)
        ) {
          profiles[activeProfile].splice(itemIndex, 1);
          saveProfiles();
          renderShoppingList();
        }
      });
    </script>
  </body>
</html>
